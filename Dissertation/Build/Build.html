<!DOCTYPE html>
<html>

<head>
  <title>WebGL 3D Model Viewer</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
  <!-- GUI -->
  <div id="SideBar">
    <span class="slide">
      <a href="#" onclick="openSlideMenu()">
        <i id="Hamburger">â‰¡</i>
      </a>
    </span>

    <div id="SettingsMenu" class="nav">
      <a href="#" class="close" onclick="closeSlideMenu()">
        <i id="X">X</i>
      </a>
      <ul class="SideBarUl">
        <!-- Camera Settings-->
        <li onclick="this.classList.toggle('clicked')"><a href="#">Camera</a>
          <ul>
            <li><a href="#" onclick="toggleAutoRotate()">Auto Rotate</a></li>
            <li><a href="#" onclick="toggleCamReset()">Reset</a></li>
          </ul>
        </li>

        <!-- Model Settings -->
        <li onclick="this.classList.toggle('clicked')"><a  href="#">Models</a>
          <ul>
            <li><a href="#" onclick="toggleModelWireframe()">Wireframe</a></li>
            <li><a href="#">Load Model</a></li>
          </ul>
        </li>

        <!-- Lighting Settings -->
        <li onclick="this.classList.toggle('clicked')"><a href="#">Lighting</a>
          <ul  id="LightListTop">
            <li><a>Existing Lights:</a></li>
            <li id="LightListBottom"><a href="#" onclick="addLight()">New Light</a></li>
          </ul>
        </li>

        <li onclick="this.classList.toggle('clicked')"><a href="#">Rendering</a>
          <ul>
            <li><a href="#" onclick=""></a></li>
          </ul>
        </li>

        <li onclick="this.classList.toggle('clicked')"><a href="#">Skybox</a>
          <ul>
            <li onclick="this.classList.toggle('clicked')"><a href="#">Textures:</a>
              <ul>
                <a href="#" onclick="">Front:</a>
                <input type="file" id="NewFrontIMG" accept="image/*">

                <a href="#" onclick="">Back:</a>
                <input type="file" id="NewBackIMG" accept="image/*">

                <a href="#" onclick="">Up:</a>
                <input type="file" id="NewUpIMG" accept="image/*">

                <a href="#" onclick="">Down:</a>
                <input type="file" id="NewDownIMG" accept="image/*">

                <a href="#" onclick="">Right:</a>
                <input type="file" id="NewRightIMG" accept="image/*">

                <a href="#" onclick="">Left:</a>
                <input type="file" id="NewLeftIMG" accept="image/*">
              </ul>
            </li>

            <li><a href="#" onclick="updateSkybox()">Reload</a></li>
          </ul>
        </li>

        <div class="preview"></div>

        <ul class="Focus">
          <!-- colorpicker element -->
          <div class="colorpicker" style="display:none">
            <a>Light Settings</a>
            <canvas id="picker"></canvas>
            <div class="controls">
              <div><label>Name</label> <input type="text" id="lightName" /></div>
              <div><label>Type</label> <input type="text" id="lightType" /></div>
              <div><label>R</label> <input type="text" id="rVal" /></div>
              <div><label>G</label> <input type="text" id="gVal" /></div>
              <div><label>B</label> <input type="text" id="bVal" /></div>
              <div><label>HEX</label> <input type="text" id="hexVal" /></div>
              <li><a href="#" onclick="">Show Helper</a></li>
              <li><a href="#" onclick="defaultLighting()">Reset to Default</a></li>
            </div>
          </div>
        </ul>

      </ul>
    </div>
  </div>

  <!-- Includes -->
  <script src="Imports/three.js"></script>
  <script src="Imports/Detector.js"></script>
  <script src="Imports/OrbitControls.js"></script>
  <script src="Imports/OBJLoader.js"></script>
  <script src="Imports/MTLLoader.js"></script>
  <script src="Imports/jquery.js"></script>
  <script src="Imports/ColourPicker.js"></script>

  <!-- Program -->
  <script>

  //Displays message to the user if webGL is not supported in the browser.
  if (!Detector.webgl) {
    Detector.addGetWebGLMessage();
  }

  //Structs
  function ModelObject (path) {

  }

  //Globals
  var container = document.createElement('div');
  document.body.appendChild(container);

  //Clean Variables
  var Lights = [];
  var LightHelpers = [];
  var Models = [];
  var Skybox;



  //Old
  var camera, controls, renderer;
  var shadowSwitch = true;
  var ambientLight;
  var pointLights = [];

  var gridHelper, plane;


  var planeSize;

  var model, wireframeModel, cloneModel;

  var windowHalfX = window.innerWidth / 2;
  var windowHalfY = window.innerHeight / 2;

  var scene = new THREE.Scene();

  init();
  animate();

  function toRadians (angle) {
    return angle * (Math.PI / 180);
  }

  function drawPlane(x,y) {
    var planeGeometry = new THREE.PlaneGeometry( x, y, 1, 1 );
    var planeMaterial = new THREE.MeshPhongMaterial( {color: 0x707070, side: THREE.DoubleSide} );
    plane = new THREE.Mesh( planeGeometry, planeMaterial );
    plane.rotation.x = toRadians(90);
    plane.receiveShadow = true;
    scene.add( plane );
    planeSize = new THREE.Box3().setFromObject( plane );

  }

  function setupCamera(x, y, z, near, far) {
    /* Camera */
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, near, far);
    camera.position.x = x;
    camera.position.y = y;
    camera.position.z = z;

    /* Renderer */
    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;

    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(new THREE.Color("hsl(0, 0%, 10%)"));

    container.appendChild(renderer.domElement);

    /* Controls */
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.25;
    controls.enableZoom = true;
    controls.maxDistance = 1500;
    controls.minDistance = 3;
    controls.autoRotate = false;
    controls.autoRotateSpeed = -0.5;
    controls.maxPolarAngle = 1.5;
  }

  function defaultSkybox() {
    var skyboxGeometry = new THREE.CubeGeometry(10000, 10000, 10000);
    var skyboxMaterials =
    [
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load("Assets/Skybox/Front.png"), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load("Assets/Skybox/Back.png"), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load("Assets/Skybox/Up.png"), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load("Assets/Skybox/Down.png"), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load("Assets/Skybox/Right.png"), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load("Assets/Skybox/Left.png"), side: THREE.DoubleSide})
    ];

    Skybox = new THREE.Mesh(skyboxGeometry, skyboxMaterials);
    scene.add (Skybox);
  }

  function drawGrid(size, divs){
    /* Grid */
    var gridSize = size;
    var divisions = divs;

    gridHelper = new THREE.GridHelper(gridSize, divisions);
  }

  function loadDefaultModel() {
    var mtlLoader = new THREE.MTLLoader();
    mtlLoader.setPath('Assets/');
    mtlLoader.load( 'Chubby Monkey.mtl', function( materials )
    {
      materials.preload();

      var objLoader = new THREE.OBJLoader();

      objLoader.setMaterials( materials );
      objLoader.setPath('Assets/');
      objLoader.load( 'Chubby Monkey.obj', function ( object ) {

        model = object;

        model.traverse( function ( child )
        {
          if (child instanceof THREE.Mesh)
          {
            child.castShadow = true;
          }
        });

        wireframeModel = model.clone();
        cloneModel = model.clone();

        wireframeModel.traverse( function ( child )
        {
          if ( child instanceof THREE.Mesh )
          {
            child.material = new THREE.MeshBasicMaterial( { color: 0xffffff, wireframe : true  }  );
          }
        } );
        scene.add( model );
      } );
    } );
  }

  function init() {
    //Updated clean code section

    drawPlane(50, 50);
    addLight();
    setupCamera(0, 7, 15, 0.1, 10000);
    defaultSkybox();
    drawGrid(50, 50);
    loadDefaultModel();

    /* Model */


    /* Events */
    window.addEventListener('resize', onWindowResize, false);
  }

  function onWindowResize() {
    windowHalfX = window.innerWidth / 2;
    windowHalfY = window.innerHeight / 2;

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize(window.innerWidth, window.innerHeight);
  }

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    render();
  }

  function render() {
    renderer.render(scene, camera);
  }

  /* GUI Functions */

  //SideBar Controls

  function toggleAutoRotate () {
    controls.autoRotate = !controls.autoRotate;
  }

  function toggleCamReset () {
    controls.reset();
  }

  function addLight () {
    var light = new THREE.DirectionalLight(0xffe6b8, 1)
    light.name = "Directional Light";
    light.position.set(0,30,0)
    var target = new THREE.Object3D()
    target.position.set(0,0,0)
    light.target = target
    scene.add(light.target)

    light.shadow.camera.left = -10
    light.shadow.camera.right = 10
    light.shadow.camera.top = 10
    light.shadow.camera.bottom = -10
    light.shadow.camera.near = 10
    light.shadow.camera.far = 400
    light.shadow.mapSize.width = 2048
    light.shadow.mapSize.height = 2048
    light.castShadow = true

    //Create a helper for the shadow camera (optional)
    var helper = new THREE.CameraHelper( light.shadow.camera );

    ambient = new THREE.AmbientLight(0xffffff, 1.0);
    ambient.intensity = 0.5;
    scene.add(helper);
    scene.add(ambient);
    scene.add(light);

    var newLi = document.createElement("li");
    var newA = document.createElement("a");
    var newContent = document.createTextNode(light.name);
    newA.appendChild(newContent);
    newLi.appendChild(newA);

    var parentLocation = document.getElementById("LightListTop");
    var insertLocation = document.getElementById("LightListBottom");
    parentLocation.insertBefore(newA, insertLocation);
  }

  function updateSkybox(){

    scene.remove(Skybox);

    var front = document.getElementById('NewFrontIMG').files[0];
    var frontURL = URL.createObjectURL( front );

    var back = document.getElementById('NewBackIMG').files[0];
    var backURL = URL.createObjectURL( back );

    var up = document.getElementById('NewUpIMG').files[0];
    var upURL = URL.createObjectURL( up );

    var down = document.getElementById('NewDownIMG').files[0];
    var downURL = URL.createObjectURL( down );

    var right = document.getElementById('NewRightIMG').files[0];
    var rightURL = URL.createObjectURL( right );

    var left = document.getElementById('NewLeftIMG').files[0];
    var leftURL = URL.createObjectURL( left );

    var skyboxGeometry = new THREE.CubeGeometry(10000, 10000, 10000);
    var skyboxMaterials =
    [
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load(frontURL), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load(backURL), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load(upURL), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load(downURL), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load(rightURL), side: THREE.DoubleSide}),
      new THREE.MeshBasicMaterial ( { map: new THREE.TextureLoader().load(leftURL), side: THREE.DoubleSide})
    ];

    Skybox = new THREE.Mesh(skyboxGeometry, skyboxMaterials);
    scene.add(Skybox);
  }

  /* HTML JavaScript Extensions */

  //Sliding Nav Bar
  function openSlideMenu() {
    document.getElementById('SettingsMenu').style.width = '250px';
    document.getElementById('SideBar').style.marginLeft = '250px';
    document.getElementById('Hamburger').style.opacity = '0';
  }
  function closeSlideMenu() {
    document.getElementById('SettingsMenu').style.width = '0px';
    document.getElementById('SideBar').style.marginLeft = '0px';
    document.getElementById('Hamburger').style.opacity = '1';
  }

  </script>
</body>
</html>
